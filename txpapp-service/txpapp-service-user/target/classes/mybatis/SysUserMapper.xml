<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.txp.app.system.repository.SysUserMapper" >
  <resultMap id="BaseResultMap" type="com.txp.app.system.dto.SysUser" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jan 02 10:29:29 CST 2018.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="login_name" property="loginName" jdbcType="VARCHAR" />
    <result column="real_name" property="realName" jdbcType="VARCHAR" />
    <result column="password" property="password" jdbcType="VARCHAR" />
    <result column="sex" property="sex" jdbcType="VARCHAR" />
    <result column="email" property="email" jdbcType="VARCHAR" />
    <result column="phone" property="phone" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="BIT" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
    <!--
    <result column="collector_status" property="collectorStatus" jdbcType="BIT" />
    <result column="invite_code" property="inviteCode" jdbcType="VARCHAR" />
    -->
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jan 02 10:29:29 CST 2018.
    -->
    id, login_name, real_name, password, sex, email, phone, status, create_time, update_time,
    collector_status, invite_code
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jan 02 10:29:29 CST 2018.
    -->
    select
    <include refid="Base_Column_List" />
    from sys_user
    where id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jan 02 10:29:29 CST 2018.
    -->
    delete from sys_user
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.txp.app.system.dto.SysUser" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jan 02 10:29:29 CST 2018.
    -->
    insert into sys_user (id, login_name, real_name,
    password, sex, email,
    phone, status, create_time,
    update_time, collector_status, invite_code
    )
    values (#{id,jdbcType=BIGINT}, #{loginName,jdbcType=VARCHAR}, #{realName,jdbcType=VARCHAR},
    #{password,jdbcType=VARCHAR}, #{sex,jdbcType=VARCHAR}, #{email,jdbcType=VARCHAR},
    #{phone,jdbcType=VARCHAR}, #{status,jdbcType=BIT}, #{createTime,jdbcType=TIMESTAMP},
    #{updateTime,jdbcType=TIMESTAMP}, #{collectorStatus,jdbcType=BIT}, #{inviteCode,jdbcType=VARCHAR}
    )
  </insert>
  <insert id="insertSelective" parameterType="com.txp.app.system.dto.SysUser" useGeneratedKeys="true" keyProperty="id" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jan 02 10:29:29 CST 2018.
    -->
    insert into sys_user
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="loginName != null" >
        login_name,
      </if>
      <if test="realName != null" >
        real_name,
      </if>
      <if test="password != null" >
        password,
      </if>
      <if test="sex != null" >
        sex,
      </if>
      <if test="email != null" >
        email,
      </if>
      <if test="phone != null" >
        phone,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
      <if test="updateTime != null" >
        update_time,
      </if>
      <if test="collectorStatus != null" >
        collector_status,
      </if>
      <if test="inviteCode != null" >
        invite_code,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=BIGINT},
      </if>
      <if test="loginName != null" >
        #{loginName,jdbcType=VARCHAR},
      </if>
      <if test="realName != null" >
        #{realName,jdbcType=VARCHAR},
      </if>
      <if test="password != null" >
        #{password,jdbcType=VARCHAR},
      </if>
      <if test="sex != null" >
        #{sex,jdbcType=VARCHAR},
      </if>
      <if test="email != null" >
        #{email,jdbcType=VARCHAR},
      </if>
      <if test="phone != null" >
        #{phone,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        #{status,jdbcType=BIT},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null" >
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="collectorStatus != null" >
        #{collectorStatus,jdbcType=BIT},
      </if>
      <if test="inviteCode != null" >
        #{inviteCode,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.txp.app.system.dto.SysUser" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jan 02 10:29:29 CST 2018.
    -->
    update sys_user
    <set >
      <if test="loginName != null" >
        login_name = #{loginName,jdbcType=VARCHAR},
      </if>
      <if test="realName != null" >
        real_name = #{realName,jdbcType=VARCHAR},
      </if>
      <if test="password != null" >
        password = #{password,jdbcType=VARCHAR},
      </if>
      <if test="sex != null" >
        sex = #{sex,jdbcType=VARCHAR},
      </if>
      <if test="email != null" >
        email = #{email,jdbcType=VARCHAR},
      </if>
      <if test="phone != null" >
        phone = #{phone,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=BIT},
      </if>
      <if test="createTime != null" >
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null" >
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="collectorStatus != null" >
        collector_status = #{collectorStatus,jdbcType=BIT},
      </if>
      <if test="inviteCode != null" >
        invite_code = #{inviteCode,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.txp.app.system.dto.SysUser" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jan 02 10:29:29 CST 2018.
    -->
    update sys_user
    set login_name = #{loginName,jdbcType=VARCHAR},
    real_name = #{realName,jdbcType=VARCHAR},
    password = #{password,jdbcType=VARCHAR},
    sex = #{sex,jdbcType=VARCHAR},
    email = #{email,jdbcType=VARCHAR},
    phone = #{phone,jdbcType=VARCHAR},
    status = #{status,jdbcType=BIT},
    create_time = #{createTime,jdbcType=TIMESTAMP},
    update_time = #{updateTime,jdbcType=TIMESTAMP},
    collector_status = #{collectorStatus,jdbcType=BIT},
    invite_code = #{inviteCode,jdbcType=VARCHAR}
    where id = #{id,jdbcType=BIGINT}
  </update>

  <select id="selectAllList" parameterType="map" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jan 02 10:29:29 CST 2018.
    -->
    select
    <include refid="Base_Column_List" />
    from sys_user
    WHERE 1=1
    <if test="loginName != null" >
      AND login_name=#{loginName}
    </if>
  </select>

  <select id="findSysUserListCount" parameterType="map" resultType="java.lang.Long">
    select count(1) from sys_user u LEFT JOIN mall_supplier_sysuser r on u.id = r.sys_user_id
    WHERE 1=1
    <if test="realName != null" >
      AND u.real_name LIKE CONCAT('%',#{realName},'%' )
    </if>
    <if test="status != null" >
      AND u.status = #{status}
    </if>
    <if test="sex != null" >
      AND u.sex = #{sex}
    </if>
    <if test="beginTime != null" >
      <![CDATA[   AND left(u.create_time,10) >= #{beginTime} ]]>
    </if>
    <if test="endTime != null" >
      <![CDATA[   AND left(u.create_time,10) <= #{endTime} ]]>
    </if>
    <if test="mallSupplierId != null" >
      AND r.mall_supplier_id = #{mallSupplierId}
      AND r.type = 0
    </if>
    AND u.login_name not in ('${@com.txp.app.util.SystemConstant@SUPER_ADMIN}')
  </select>

  <select id="findSysUserList" parameterType="map" resultMap="BaseResultMap">
    select u.id,u.login_name,u.real_name,u.sex,u.email,u.phone,u.status,u.create_time,u.update_time,(select group_concat(role_id) from sys_user_role where user_id=u.id) password from sys_user u
    LEFT JOIN mall_supplier_sysuser r on u.id = r.sys_user_id
    WHERE 1=1
    <if test="realName != null" >
      AND u.real_name LIKE CONCAT('%',#{realName},'%' )
    </if>
    <if test="status != null" >
      AND u.status = #{status}
    </if>
    <if test="sex != null" >
      AND u.sex = #{sex}
    </if>
    <if test="beginTime != null" >
      <![CDATA[   AND left(u.create_time,10) >= #{beginTime} ]]>
    </if>
    <if test="endTime != null" >
      <![CDATA[   AND left(u.create_time,10) <= #{endTime} ]]>
    </if>
    <if test="mallSupplierId != null" >
      AND r.mall_supplier_id = #{mallSupplierId}
      AND r.type = 0
    </if>
    AND u.login_name not in ('${@com.txp.app.util.SystemConstant@SUPER_ADMIN}')
    ORDER by u.update_time DESC
    LIMIT #{startIndex},#{endIndex}
  </select>

  <select id="selectRoleName" resultType="java.lang.String">
    select group_concat(role_name) roleName from sys_role
    where id in
    <foreach item="item" index="index" collection="roleIds"
             open="(" separator="," close=")">
      #{item}
    </foreach>
  </select>

  <delete id="deleteSysUserRole" parameterType="java.lang.Long">
    delete from sys_user_role where user_id=#{userId}
  </delete>

  <delete id="deleteByIds" parameterType="java.lang.String">
    DELETE FROM sys_user WHERE id in (#{ids})
  </delete>

  <select id="queryOrg" parameterType="java.lang.String" resultType="java.lang.String">
    select role_id from sys_user_role s where s.user_id=(select id from sys_user u where u.login_name=#{username} and u.status='1' ) and s.role_id=(select id from sys_role where role_code='superadmin')
  </select>

  <select id="selectRoleId" parameterType="java.lang.Long" resultType="java.lang.String">
    select group_concat(role_id) role_id from sys_user_role where user_id=#{id}
  </select>

  <select id="selectSysRule" resultType="com.txp.app.system.dto.SysRule">
    select DISTINCT
    r.id,
    r.parent_id as parentId,
    r.rule_code as ruleCode,
    rule_name as ruleName,
    rule_type as ruleType,
    rule_desc as ruleDesc,
    rule_url as ruleUrl,
    rule_order as ruleOrder,
    rule_picture as rulePicture,
    rule_ext as ruleExt,
    lft,
    rgt  from sys_role_rule rr LEFT JOIN sys_rule r on r.id=rr.rule_id
    where rr.role_id in
    <foreach item="item" index="index" collection="roleIds"
             open="(" separator="," close=")">
      #{item}
    </foreach>
  </select>
  <!--
  <select id="selectMerchantSysuserBySysId" parameterType="java.lang.Long" resultType="java.lang.Integer">
    SELECT count(1) FROM bw_merchant_sysuser s WHERE s.sys_id = #{id}
  </select>
  -->

  <select id="findSysUserListCountNew" parameterType="map" resultType="java.lang.Integer">
    select count(1) from sys_user u LEFT JOIN mall_supplier_sysuser r on u.id = r.sys_user_id
    <include refid="statusSelectCondition"/>
  </select>

  <select id="findSysUserListNew" parameterType="map" resultMap="BaseResultMap">
    select u.id,u.login_name,u.real_name,u.sex,u.email,u.phone,u.status,u.create_time,u.update_time,(select group_concat(role_id) from sys_user_role where user_id=u.id) password from sys_user u
    LEFT JOIN mall_supplier_sysuser r on u.id = r.sys_user_id
    <include refid="statusSelectCondition"/>
    ORDER by u.update_time DESC
    LIMIT #{start},#{limit}
  </select>

  <sql id="statusSelectCondition">
    <where>
      1=1
      <if test="realName != null" >
        AND u.real_name LIKE CONCAT('%',#{realName},'%' )
      </if>
      <if test="status != null" >
        AND u.status = #{status}
      </if>
      <if test="sex != null" >
        AND u.sex = #{sex}
      </if>
      <if test="beginTime != null" >
        <![CDATA[   AND u.create_time >= #{beginTime} ]]>
      </if>
      <if test="endTime != null" >
        <![CDATA[   AND u.create_time <= #{endTime} ]]>
      </if>
      <if test="mallSupplierId != null" >
        AND r.mall_supplier_id = #{mallSupplierId}
        AND r.type = 0
      </if>
      AND u.login_name not in ('${@com.txp.app.util.SystemConstant@SUPER_ADMIN}')
    </where>
  </sql>

</mapper>