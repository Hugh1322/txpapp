<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.txp.app.system.repository.SysRoleMapper" >

  <insert id="insertSelective" parameterType="com.txp.app.system.dto.SysRole" useGeneratedKeys="true" keyProperty="id">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jan 02 10:29:29 CST 2018.
    -->
    insert into sys_role
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="roleCode != null" >
        role_code,
      </if>
      <if test="roleName != null" >
        role_name,
      </if>
      <if test="roleDesc != null" >
        role_desc,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=BIGINT},
      </if>
      <if test="roleCode != null" >
        #{roleCode,jdbcType=VARCHAR},
      </if>
      <if test="roleName != null" >
        #{roleName,jdbcType=VARCHAR},
      </if>
      <if test="roleDesc != null" >
        #{roleDesc,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>

  <delete id="delete" parameterType="java.lang.Long">
    delete from sys_role where id=#{id}
  </delete>

  <update id="update" parameterType="com.txp.app.system.dto.SysRole">
    update sys_role set role_name=#{roleName},role_code=#{roleCode},role_desc=#{roleDesc} where id =#{id}
  </update>

  <select id="selectRoleListCount" parameterType="map" resultType="java.lang.Long">
    SELECT count(1) FROM sys_role r
    <if test="supplierId != null" >
      LEFT JOIN mall_supplier_role sr on r.id = sr.sys_role_id WHERE sr.mall_supplier_id = #{supplierId}
    </if>
  </select>

  <select id="selectRoleList" parameterType="map" resultType="com.txp.app.system.dto.SysRole">
    SELECT
        r.id,
        role_code as roleCode,
        role_name as roleName,
        role_desc as roleDesc
    FROM
        sys_role r
      <if test="supplierId != null" >
        LEFT JOIN mall_supplier_role sr on r.id = sr.sys_role_id WHERE sr.mall_supplier_id = #{supplierId}
      </if>
    LIMIT #{startIndex},#{endIndex}
  </select>

  <select id="findsByPageCountNew" parameterType="map" resultType="java.lang.Integer">
    SELECT count(1) FROM sys_role r
    <if test="supplierId != null" >
      LEFT JOIN mall_supplier_role sr on r.id = sr.sys_role_id WHERE sr.mall_supplier_id = #{supplierId}
    </if>
  </select>

  <select id="findsByPageNew" parameterType="map" resultType="com.txp.app.system.dto.SysRole">
    SELECT
    r.id,
    role_code as roleCode,
    role_name as roleName,
    role_desc as roleDesc
    FROM
    sys_role r
    <if test="supplierId != null" >
      LEFT JOIN mall_supplier_role sr on r.id = sr.sys_role_id WHERE sr.mall_supplier_id = #{supplierId}
    </if>
    LIMIT #{start},#{limit}
  </select>


  <select id="selectRoleById" parameterType="java.lang.Long" resultType="com.txp.app.system.dto.SysRole">
    SELECT id,role_code as roleCode,role_name as roleName,role_desc as roleDesc FROM sys_role where id =#{id}
  </select>

  <insert id="insertRoleRule" parameterType="com.txp.app.system.dto.SysRoleRule" useGeneratedKeys="true" keyProperty="id">
    insert into sys_role_rule
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="roleId != null" >
        role_id,
      </if>
      <if test="ruleId != null" >
        rule_id,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="roleId != null" >
        #{roleId,jdbcType=BIGINT},
      </if>
      <if test="ruleId != null" >
        #{ruleId,jdbcType=BIGINT},
      </if>
    </trim>
  </insert>

  <select id="selectAllList" resultType="com.txp.app.system.dto.SysRole">
    SELECT id,role_code as roleCode,role_name as roleName,role_desc as roleDesc from sys_role
  </select>

  <select id="selectOne" parameterType="java.lang.Long" resultType="java.lang.String">
    select group_concat(role_id) role_id from sys_user_role where user_id = #{userID}
  </select>

  <select id="selectListByUserId" parameterType="java.lang.String" resultType="com.txp.app.system.dto.SysRole">
    select r.* from sys_role r where id in (#{split})
  </select>

  <select id="selectSysRoleByUserId" parameterType="java.lang.Long" resultType="com.txp.app.system.dto.SysRole">
    SELECT
        r.id,
        r.role_code AS roleCode,
        r.role_name AS roleName,
        r.role_desc AS roleDesc
    FROM
        sys_role r
    LEFT JOIN sys_user_role u ON r.id = u.role_id
    WHERE
        u.user_id = #{userID}
  </select>

  <select id="selectRuleList" parameterType="java.lang.Long" resultType="com.txp.app.system.dto.SysRule">
    SELECT
        r.id,
        r.parent_id as parentId,
        r.rule_code as ruleCode,
        rule_name as ruleName,
        rule_type as ruleType,
        rule_desc as ruleDesc,
        rule_url as ruleUrl,
        rule_order as ruleOrder,
        rule_picture as rulePicture,
        rule_ext as ruleExt,
        lft,
        rgt
    FROM
        sys_rule r
    LEFT JOIN sys_role_rule l ON r.id = l.rule_id
    LEFT JOIN sys_role e ON e.id = l.role_id
    WHERE
        l.role_id = #{id}
  </select>

  <delete id="deleteRoleRule" parameterType="java.lang.Long">
    delete from sys_role_rule WHERE role_id=#{roleIds}
  </delete>

  <delete id="deleteUserRole" parameterType="java.lang.Long">
    delete from sys_user_role WHERE role_id=#{roleId}
  </delete>

    <select id="findByName" parameterType="java.lang.String" resultType="java.lang.Integer">
      SELECT count(1) FROM sys_role r WHERE r.role_name = #{roleName}
    </select>

    <select id="findByCode" parameterType="java.lang.String" resultType="java.lang.Integer">
      SELECT count(1) FROM sys_role r WHERE r.role_code = #{roleCode}
    </select>

    <select id="findBySysRole" parameterType="com.txp.app.system.dto.SysRole" resultType="java.lang.Integer">
      SELECT count(1) FROM sys_role r WHERE (r.role_code = #{roleCode} OR r.role_name = #{roleName} ) AND r.id != #{id}
    </select>

  <select id="findUserBySysRole" parameterType="java.lang.Long" resultType="java.lang.Long">
    SELECT r.user_id FROM sys_user_role r WHERE r.role_id = #{roleId}
  </select>

</mapper>